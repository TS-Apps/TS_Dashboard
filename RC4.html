<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sea Cadet Training Dashboard - Cloud</title>
    
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>⚓</text></svg>" />
    
    <!-- React -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- jsPDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    
    <!-- Supabase Client -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <style>
        body { background-color: #f1f5f9; }
        .drag-active { border-color: #3b82f6; background-color: #eff6ff; }
        
        /* Planner Table Styles */
        .planner-table th, .planner-table td { white-space: nowrap; }
        .planner-container { overflow-x: auto; max-height: 75vh; }
        
        /* Sticky Headers */
        .planner-table thead { position: sticky; top: 0; z-index: 50; }
        .planner-table th { position: sticky; top: 0; z-index: 50; box-shadow: 0 1px 2px rgba(0,0,0,0.1); }
        
        /* Sticky First Column */
        .planner-table th:first-child, .planner-table td:first-child {
            position: sticky; left: 0; z-index: 60 !important;
            background-color: #FFFFFF !important; border-right: 2px solid #e2e8f0;
        }
        .planner-table thead tr th:first-child {
            z-index: 70 !important; background-color: #f1f5f9 !important;
        }

        /* Custom scrollbar */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #f1f5f9; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
        
        .bg-passed { background-color: #0DAC50 !important; }
        
        /* Spec Level Colors */
        .spec-basic { background-color: #fdba74 !important; color: #7c2d12; font-weight: 700; font-size: 12px; }
        .spec-int { background-color: #94a3b8 !important; color: #ffffff; font-weight: 700; font-size: 12px; }
        .spec-adv { background-color: #fcd34d !important; color: #78350f; font-weight: 800; font-size: 12px; }
        .spec-junior { background-color: #f1f5f9 !important; color: #94a3b8; font-style: italic; font-size: 11px; }
        .spec-none { color: #cbd5e1; }

        /* Waterborne Status Colors */
        .planner-table td.status-cox-pending { background-color: #add8e6 !important; color: black !important; }
        .planner-table td.status-cox-awarded { background-color: #003366 !important; color: white !important; }
        .planner-table td.status-master-pending { background-color: #ffffe0 !important; color: black !important; }
        .planner-table td.status-master-awarded { background-color: #ffd700 !important; color: black !important; }
        
        /* Progress Chart Checkmarks */
        .bg-red-600 { color: white; font-weight: bold; font-size: 14px; }
        .bg-blue-600 { color: white; font-weight: bold; font-size: 14px; }
        .bg-green-600 { color: white; font-weight: bold; font-size: 14px; }
        .bg-yellow-600 { color: white; font-weight: bold; font-size: 14px; }
        .bg-purple-600 { color: white; font-weight: bold; font-size: 14px; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useCallback, useRef, Component } = React;
        
        const DATA_VERSION = "4.0.0-supabase";
        
        // ═══════════════════════════════════════════════════════════════════════════
        // SUPABASE CONFIGURATION
        // ═══════════════════════════════════════════════════════════════════════════
        const SUPABASE_URL = 'https://dussngodqlbmfduwfvkc.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImR1c3NuZ29kcWxibWZkdXdmdmtjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjgyMDYwNzgsImV4cCI6MjA4Mzc4MjA3OH0.pCGxiK5lNcmZ0Mv3nQozZlZi-ykliJIma99Y7ekNMKY';
        
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        
        // ═══════════════════════════════════════════════════════════════════════════
        // REACT-SAFE ICON COMPONENT
        // ═══════════════════════════════════════════════════════════════════════════
        const Icon = React.memo(({ name, className = "" }) => {
            const ref = useRef(null);
            const [initialized, setInitialized] = useState(false);
            
            useEffect(() => {
                if (ref.current && window.lucide && !initialized) {
                    const iconName = name.replace(/([a-z0-9])([A-Z])/g, '$1-$2').toLowerCase();
                    ref.current.setAttribute('data-lucide', iconName);
                    
                    requestAnimationFrame(() => {
                        try {
                            window.lucide.createIcons();
                            setInitialized(true);
                        } catch (e) {
                            // Icon render failed silently
                        }
                    });
                }
            }, [name, initialized]);
            
            return <i ref={ref} className={className}></i>;
        });
        
        // ═══════════════════════════════════════════════════════════════════════════
        // AUTHENTICATION COMPONENTS
        // ═══════════════════════════════════════════════════════════════════════════
        
        const LoginForm = ({ onLogin }) => {
            const [email, setEmail] = useState('');
            const [password, setPassword] = useState('');
            const [loading, setLoading] = useState(false);
            const [error, setError] = useState('');
            const [isSignUp, setIsSignUp] = useState(false);

            const handleSubmit = async (e) => {
                e.preventDefault();
                setError('');
                setLoading(true);

                try {
                    if (isSignUp) {
                        const { data, error } = await supabase.auth.signUp({
                            email,
                            password,
                        });
                        
                        if (error) throw error;
                        
                        setError('Check your email for the confirmation link!');
                        setIsSignUp(false);
                    } else {
                        const { data, error } = await supabase.auth.signInWithPassword({
                            email,
                            password,
                        });
                        
                        if (error) throw error;
                        
                        onLogin(data.user);
                    }
                } catch (error) {
                    setError(error.message);
                } finally {
                    setLoading(false);
                }
            };

            return (
                <div className="min-h-screen flex items-center justify-center bg-slate-100">
                    <div className="bg-white p-8 rounded-lg shadow-lg max-w-md w-full">
                        <div className="text-center mb-6">
                            <h1 className="text-3xl font-bold text-blue-900 mb-2">
                                Sea Cadet Training Dashboard
                            </h1>
                            <p className="text-sm text-slate-600">
                                {isSignUp ? 'Create your account' : 'Sign in to continue'}
                            </p>
                        </div>

                        <form onSubmit={handleSubmit} className="space-y-4">
                            <div>
                                <label className="block text-sm font-medium text-slate-700 mb-1">
                                    Email
                                </label>
                                <input
                                    type="email"
                                    value={email}
                                    onChange={(e) => setEmail(e.target.value)}
                                    className="w-full px-3 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                    required
                                />
                            </div>

                            <div>
                                <label className="block text-sm font-medium text-slate-700 mb-1">
                                    Password
                                </label>
                                <input
                                    type="password"
                                    value={password}
                                    onChange={(e) => setPassword(e.target.value)}
                                    className="w-full px-3 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                    required
                                    minLength={6}
                                />
                            </div>

                            {error && (
                                <div className={`text-sm p-3 rounded ${error.includes('Check your email') ? 'bg-green-50 text-green-700' : 'bg-red-50 text-red-700'}`}>
                                    {error}
                                </div>
                            )}

                            <button
                                type="submit"
                                disabled={loading}
                                className="w-full py-2 px-4 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-lg transition-colors disabled:opacity-50"
                            >
                                {loading ? 'Please wait...' : (isSignUp ? 'Sign Up' : 'Sign In')}
                            </button>

                            <button
                                type="button"
                                onClick={() => { setIsSignUp(!isSignUp); setError(''); }}
                                className="w-full text-sm text-blue-600 hover:text-blue-700"
                            >
                                {isSignUp ? 'Already have an account? Sign in' : 'Need an account? Sign up'}
                            </button>
                        </form>

                        <div className="mt-6 text-center text-xs text-slate-400">
                            <p>Multi-user cloud-based dashboard</p>
                            <p className="mt-1">Version {DATA_VERSION}</p>
                        </div>
                    </div>
                </div>
            );
        };

        // ═══════════════════════════════════════════════════════════════════════════
        // PLACEHOLDER: INSERT YOUR COMPLETE WORKING CODE HERE
        // ═══════════════════════════════════════════════════════════════════════════
        
        // TODO: I'll insert all your constants, components, and logic from the working version
        // This is just the authentication shell and Icon component
        
        const App = () => {
            const [user, setUser] = useState(null);
            const [loading, setLoading] = useState(true);

            useEffect(() => {
                // Check current session
                supabase.auth.getSession().then(({ data: { session } }) => {
                    setUser(session?.user ?? null);
                    setLoading(false);
                });

                // Listen for auth changes
                const { data: { subscription } } = supabase.auth.onAuthStateChange((_event, session) => {
                    setUser(session?.user ?? null);
                });

                return () => subscription.unsubscribe();
            }, []);

            if (loading) {
                return (
                    <div className="min-h-screen flex items-center justify-center bg-slate-100">
                        <div className="text-center">
                            <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"></div>
                            <p className="text-slate-600">Loading...</p>
                        </div>
                    </div>
                );
            }

            if (!user) {
                return <LoginForm onLogin={setUser} />;
            }

            return (
                <div className="min-h-screen bg-slate-100 p-8">
                    <div className="max-w-4xl mx-auto">
                        <div className="bg-white rounded-lg shadow p-6">
                            <div className="flex items-center justify-between mb-4">
                                <h1 className="text-2xl font-bold text-blue-900">
                                    Welcome, {user.email}
                                </h1>
                                <button
                                    onClick={() => supabase.auth.signOut()}
                                    className="px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg"
                                >
                                    Sign Out
                                </button>
                            </div>
                            <p className="text-slate-600">
                                ✅ Authentication working!<br/>
                                Next: I'll integrate all your working dashboard components here.
                            </p>
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
